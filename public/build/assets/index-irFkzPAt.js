import{r as v,g as j,R as V,a as S}from"./inertia-BH-W5z_F.js";const F={},y=t=>{let n;const e=new Set,r=(a,u)=>{const m=typeof a=="function"?a(n):a;if(!Object.is(m,n)){const f=n;n=u??(typeof m!="object"||m===null)?m:Object.assign({},n,m),e.forEach(h=>h(n,f))}},s=()=>n,i={setState:r,getState:s,getInitialState:()=>d,subscribe:a=>(e.add(a),()=>e.delete(a)),destroy:()=>{(F?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),e.clear()}},d=n=t(r,s,i);return i},P=t=>t?y(t):y;var C={exports:{}},Q={},R={exports:{}},D={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var g=v;function O(t,n){return t===n&&(t!==0||1/t===1/n)||t!==t&&n!==n}var W=typeof Object.is=="function"?Object.is:O,z=g.useState,U=g.useEffect,B=g.useLayoutEffect,N=g.useDebugValue;function A(t,n){var e=n(),r=z({inst:{value:e,getSnapshot:n}}),s=r[0].inst,o=r[1];return B(function(){s.value=e,s.getSnapshot=n,b(s)&&o({inst:s})},[t,e,n]),U(function(){return b(s)&&o({inst:s}),t(function(){b(s)&&o({inst:s})})},[t]),N(e),e}function b(t){var n=t.getSnapshot;t=t.value;try{var e=n();return!W(t,e)}catch{return!0}}function K(t,n){return n()}var G=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?K:A;D.useSyncExternalStore=g.useSyncExternalStore!==void 0?g.useSyncExternalStore:G;R.exports=D;var J=R.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var k=v,H=J;function X(t,n){return t===n&&(t!==0||1/t===1/n)||t!==t&&n!==n}var Y=typeof Object.is=="function"?Object.is:X,Z=H.useSyncExternalStore,q=k.useRef,ee=k.useEffect,te=k.useMemo,ne=k.useDebugValue;Q.useSyncExternalStoreWithSelector=function(t,n,e,r,s){var o=q(null);if(o.current===null){var c={hasValue:!1,value:null};o.current=c}else c=o.current;o=te(function(){function i(f){if(!d){if(d=!0,a=f,f=r(f),s!==void 0&&c.hasValue){var h=c.value;if(s(h,f))return u=h}return u=f}if(h=u,Y(a,f))return h;var p=r(f);return s!==void 0&&s(h,p)?(a=f,h):(a=f,u=p)}var d=!1,a,u,m=e===void 0?null:e;return[function(){return i(n())},m===null?void 0:function(){return i(m())}]},[n,e,r,s]);var l=Z(t,o[0],o[1]);return ee(function(){c.hasValue=!0,c.value=l},[l]),ne(l),l};C.exports=Q;var re=C.exports;const se=j(re),T={},{useDebugValue:oe}=V,{useSyncExternalStoreWithSelector:ae}=se;let x=!1;const ie=t=>t;function ue(t,n=ie,e){(T?"production":void 0)!=="production"&&e&&!x&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),x=!0);const r=ae(t.subscribe,t.getState,t.getServerState||t.getInitialState,n,e);return oe(r),r}const _=t=>{(T?"production":void 0)!=="production"&&typeof t!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const n=typeof t=="function"?P(t):t,e=(r,s)=>ue(n,r,s);return Object.assign(e,n),e},L=t=>t?_(t):_,w=L((t,n)=>({session:null,questions:[],currentQuestionIndex:0,answers:{},markedQuestions:[],remainingTime:0,serverEndTime:null,violationCount:0,maxViolations:5,isFullscreen:!1,isSaving:!1,showNavigation:!0,setSession:e=>t({session:e,remainingTime:e.remaining_time,serverEndTime:new Date(e.server_end_time),violationCount:e.violation_count,maxViolations:e.max_violations}),setQuestions:e=>{const r={},s=[];e.forEach(o=>{o.current_answer&&(r[o.id]=o.current_answer),o.marked&&s.push(o.id)}),t({questions:e,answers:r,markedQuestions:s})},setCurrentQuestion:e=>t({currentQuestionIndex:e}),goToQuestion:e=>{const r=n().questions.findIndex(s=>s.id===e);r!==-1&&t({currentQuestionIndex:r})},nextQuestion:()=>{const{currentQuestionIndex:e,questions:r}=n();e<r.length-1&&t({currentQuestionIndex:e+1})},prevQuestion:()=>{const{currentQuestionIndex:e}=n();e>0&&t({currentQuestionIndex:e-1})},setAnswer:(e,r)=>t(s=>({answers:{...s.answers,[e]:r}})),toggleMark:e=>t(r=>({markedQuestions:r.markedQuestions.includes(e)?r.markedQuestions.filter(o=>o!==e):[...r.markedQuestions,e]})),updateTimer:e=>t({remainingTime:e}),incrementViolation:()=>t(e=>({violationCount:e.violationCount+1})),setFullscreen:e=>t({isFullscreen:e}),setSaving:e=>t({isSaving:e}),toggleNavigation:()=>t(e=>({showNavigation:!e.showNavigation})),getCurrentQuestion:()=>{const{questions:e,currentQuestionIndex:r}=n();return e[r]||null},getProgress:()=>{const{questions:e,answers:r}=n(),s=Object.keys(r).filter(o=>r[o]).length;return{answered:s,total:e.length,percentage:e.length>0?s/e.length*100:0}},getQuestionStatus:e=>{const{answers:r,markedQuestions:s}=n();return s.includes(e)?"marked":r[e]?"answered":"unanswered"},reset:()=>t({session:null,questions:[],currentQuestionIndex:0,answers:{},markedQuestions:[],remainingTime:0,serverEndTime:null,violationCount:0,isFullscreen:!1,isSaving:!1})}));L(t=>({entries:[],userRank:null,totalParticipants:0,isLoading:!1,setEntries:n=>t({entries:n}),setUserRank:n=>t({userRank:n}),setTotalParticipants:n=>t({totalParticipants:n}),setLoading:n=>t({isLoading:n}),updateEntry:n=>t(e=>{const r=e.entries.findIndex(o=>o.user.id===n.user_id);if(r!==-1){const o=[...e.entries];return o[r]={...o[r],rank:n.rank,score:n.score,percentage:n.percentage},o.sort((c,l)=>c.rank-l.rank),{entries:o}}const s=[...e.entries,{rank:n.rank,user:{id:n.user_id,name:n.user_name,school:n.school},score:n.score,percentage:n.percentage,correct_count:n.correct_count,time_taken:n.time_taken}];return s.sort((o,c)=>o.rank-c.rank),{entries:s.slice(0,20)}})}));function fe(t){const{remainingTime:n,serverEndTime:e,updateTimer:r}=w(),s=v.useRef(null),o=v.useRef(null),c=v.useCallback(()=>e?Math.max(0,Math.floor((e-new Date)/1e3)):0,[e]);v.useEffect(()=>{if(e)return r(c()),s.current=setInterval(()=>{const i=c();r(i),i<=0&&(clearInterval(s.current),t==null||t())},1e3),o.current=setInterval(async()=>{try{const i=await S.get(route("exam.server-time")),d=new Date(i.data.server_time),a=Math.max(0,Math.floor((e-d)/1e3));r(a)}catch(i){console.error("Failed to sync time:",i)}},3e4),()=>{clearInterval(s.current),clearInterval(o.current)}},[e,c,r,t]);const l=v.useCallback(i=>{const d=Math.floor(i/3600),a=Math.floor(i%3600/60),u=i%60;return d>0?`${d}:${String(a).padStart(2,"0")}:${String(u).padStart(2,"0")}`:`${String(a).padStart(2,"0")}:${String(u).padStart(2,"0")}`},[]);return{remainingTime:n,formattedTime:l(n),isWarning:n>0&&n<=300,isCritical:n>0&&n<=60}}function me(t,n,e){const{violationCount:r,maxViolations:s,incrementViolation:o}=w(),c=v.useRef(null),l=v.useCallback(async(i,d=null)=>{const a=Date.now();if(!(c.current&&a-c.current<1e3)){c.current=a;try{const u=await S.post(route("exam.report-violation",t),{type:i,details:d});o(),n==null||n(i,u.data),u.data.auto_submitted&&(e==null||e(u.data.redirect))}catch(u){console.error("Failed to report violation:",u)}}},[t,o,n,e]);return v.useEffect(()=>{const i=()=>{document.hidden&&l("tab_switch","User switched to another tab")},d=()=>{l("blur","Window lost focus")},a=()=>{document.fullscreenElement||l("fullscreen_exit","User exited fullscreen")},u=p=>{p.preventDefault(),l("copy","User attempted to copy")},m=p=>{p.preventDefault(),l("paste","User attempted to paste")},f=p=>{p.preventDefault(),l("right_click","User right-clicked")},h=p=>{[{key:"F12"},{key:"I",ctrl:!0,shift:!0},{key:"J",ctrl:!0,shift:!0},{key:"C",ctrl:!0,shift:!0},{key:"U",ctrl:!0},{key:"S",ctrl:!0},{key:"P",ctrl:!0}].some(E=>{const I=p.key.toUpperCase()===E.key.toUpperCase(),$=E.ctrl?p.ctrlKey:!0,M=E.shift?p.shiftKey:!0;return I&&$&&M})&&(p.preventDefault(),l("keyboard_shortcut",`Blocked shortcut: ${p.key}`))};return document.addEventListener("visibilitychange",i),window.addEventListener("blur",d),document.addEventListener("fullscreenchange",a),document.addEventListener("copy",u),document.addEventListener("paste",m),document.addEventListener("contextmenu",f),document.addEventListener("keydown",h),()=>{document.removeEventListener("visibilitychange",i),window.removeEventListener("blur",d),document.removeEventListener("fullscreenchange",a),document.removeEventListener("copy",u),document.removeEventListener("paste",m),document.removeEventListener("contextmenu",f),document.removeEventListener("keydown",h)}},[l]),{violationCount:r,maxViolations:s,remainingViolations:s-r}}function ve(t,n=1e3){const{answers:e,markedQuestions:r,setSaving:s}=w(),o=v.useRef(null),c=v.useRef({}),l=v.useCallback(async(d,a,u)=>{const m=c.current[d];if(!(m&&m.answer===a&&m.isMarked===u)){s(!0);try{await S.post(route("exam.save-answer",t),{question_id:d,answer:a||null,is_marked:u}),c.current[d]={answer:a,isMarked:u}}catch(f){console.error("Failed to save answer:",f)}finally{s(!1)}}},[t,s]),i=v.useCallback((d,a,u)=>{o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{l(d,a,u)},n)},[l,n]);return{saveAnswer:l,debouncedSave:i}}function pe(t){const{setEntries:n,setTotalParticipants:e,updateEntry:r}=useLeaderboardStore();v.useEffect(()=>t?(window.Echo.channel(`leaderboard.${t}`).listen(".leaderboard.updated",o=>{r(o.entry),e(o.total_participants)}),()=>{window.Echo.leave(`leaderboard.${t}`)}):void 0,[t,r,e])}export{fe as a,me as b,ve as c,pe as d,w as u};
